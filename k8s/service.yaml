apiVersion: v1
kind: Service
metadata:
  name: customer-service
  labels:
    app: customer-service
spec:
  # ============================================================
  # Service Type: ClusterIP
  # ============================================================
  # This creates a stable internal IP for the customer-service
  # 
  # Key Points:
  # - Only exposes the BUSINESS service (port 9090)
  # - Does NOT expose the sidecar (port 8080)
  # - Sidecar is internal to the Pod - not accessible externally
  # 
  # In Service Mesh:
  # - Envoy intercepts traffic to this service
  # - Provides load balancing, retries, circuit breaking
  # - Enforces mTLS between services
  # ============================================================
  type: ClusterIP
  
  selector:
    app: customer-service
  
  ports:
  # Only expose the business application port
  - name: http
    port: 80
    targetPort: 9090
    protocol: TCP

---
# ============================================================
# Optional: NodePort for local testing
# ============================================================
# Uncomment this to access the service from outside the cluster
# (useful for minikube/kind testing)
# ============================================================
apiVersion: v1
kind: Service
metadata:
  name: customer-service-nodeport
  labels:
    app: customer-service
spec:
  type: NodePort
  selector:
    app: customer-service
  ports:
  - name: http
    port: 9090
    targetPort: 9090
    nodePort: 30090  # Access via http://localhost:30090 (minikube) or http://<node-ip>:30090
    protocol: TCP

